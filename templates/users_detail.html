<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>用户详情</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>
<body>
<div class="container py-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>用户详情 - {{ user.username }}</h3>
        <a href="{{ url_for('users_list') }}" class="btn btn-sm btn-outline-secondary">返回用户列表</a>
    </div>

    <div class="mb-3">
        <p>卡号 UID：{{ user.card_uid }}</p>
        <p>生日：{{ user.birthdate }}</p>
        <p>余额：<strong>{{ "%.2f"|format(user.balance or 0) }} 元</strong></p>
        <p>状态：
            {% if user.is_active %}
                <span class="badge bg-success">启用</span>
            {% else %}
                <span class="badge bg-secondary">停用</span>
            {% endif %}
        </p>
    </div>

    <h5 class="mt-4">最近上机记录</h5>
    <table class="table table-sm table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>设备</th>
            <th>开始时间</th>
            <th>结束时间</th>
            <th>时长(s)</th>
            <th>费用(元)</th>
            <th>结束原因</th>
        </tr>
        </thead>
        <tbody>
        {% for s in sessions %}
        <tr>
            <td>{{ s.id }}</td>
            <td>{{ s.device_id }}</td>
            <td>{{ s.start_time }}</td>
            <td>{{ s.end_time }}</td>
            <td>{{ s.duration_sec }}</td>
            <td>{{ "%.2f"|format(s.fee or 0) }}</td>
            <td>{{ s.end_reason }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <h5 class="mt-4">最近充值记录</h5>
    <table class="table table-sm table-striped">
        <thead>
        <tr>
            <th>时间</th>
            <th>金额(元)</th>
            <th>充值后余额(元)</th>
            <th>操作员</th>
            <th>备注</th>
        </tr>
        </thead>
        <tbody>
        {% for r in recharges %}
        <tr>
            <td>{{ r.created_at }}</td>
            <td>{{ "%.2f"|format(r.amount or 0) }}</td>
            <td>{{ "%.2f"|format(r.balance_after or 0) }}</td>
            <td>{{ r.operator }}</td>
            <td>{{ r.remark }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <h5 class="mt-4">最近扣费记录</h5>
    <table class="table table-sm table-striped">
        <thead>
        <tr>
            <th>时间</th>
            <th>会话ID</th>
            <th>金额(元)</th>
        </tr>
        </thead>
        <tbody>
        {% for c in consumes %}
        <tr>
            <td>{{ c.created_at }}</td>
            <td>{{ c.session_id }}</td>
            <td>{{ "%.2f"|format(c.amount or 0) }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</div>
</body>
</html>
