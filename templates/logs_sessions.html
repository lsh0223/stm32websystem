<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>上机记录</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>body { background-color: #fff; padding: 20px; }</style>
</head>
<body>
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4 pb-2 border-bottom">
            <h3><i class="fas fa-history text-info"></i> 上机消费记录</h3>
            <span class="text-muted">显示最近 200 条</span>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="ps-4">记录ID</th>
                                <th>用户</th>
                                <th>设备</th>
                                <th>开始时间</th>
                                <th>结束时间</th>
                                <th>时长</th>
                                <th>费用</th>
                                <th>结束原因</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s in sessions %}
                            <tr>
                                <td class="ps-4 text-muted small">#{{ s.id }}</td>
                                <td class="fw-bold">{{ s.username }}</td>
                                <td><span class="badge bg-secondary">{{ s.device_id }}</span></td>
                                <td>{{ s.start_time }}</td>
                                <td>{{ s.end_time or '-' }}</td>
                                <td>
                                    {% if s.duration_sec %}
                                    {{ (s.duration_sec / 60)|int }} 分钟
                                    {% else %}
                                    <span class="spinner-grow spinner-grow-sm text-success" role="status"></span> 进行中
                                    {% endif %}
                                </td>
                                <td class="fw-bold text-danger">
                                    {% if s.fee %} ¥{{ "%.2f"|format(s.fee) }} {% else %} - {% endif %}
                                </td>
                                <td>
                                    {% if s.end_reason == 'normal' or s.end_reason == 'user_checkout' %}
                                        <span class="text-success"><i class="fas fa-check-circle"></i> 正常下机</span>
                                        
                                    {% elif s.end_reason == 'balance_empty' or s.end_reason == 'low_balance' or s.end_reason == 'balance_zero' %}
                                        <span class="text-warning fw-bold"><i class="fas fa-coins"></i> 余额耗尽</span>
                                        
                                    {% elif s.end_reason == 'admin_stop' or s.end_reason == 'forced' or s.end_reason == 'checkout' %}
                                        <span class="text-danger"><i class="fas fa-ban"></i> 管理员强制</span>
                                        
                                    {% elif s.end_reason == 'auto_checkout' %}
                                        <span class="text-secondary"><i class="fas fa-clock"></i> 自动下机</span>
                                        
                                    {% elif s.end_reason %}
                                        <span class="text-muted">{{ s.end_reason }}</span>
                                    {% else %}
                                        <span class="text-success">使用中</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="8" class="text-center py-4">暂无记录</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
